---
title: "An Analysis of Power Loss in Houston Residences during Winter Storm Uri, February 2021"
author: Henry Oliver
format: html
---
## Purpose
The purpose of this analysis is to estimate the number of homes in Houston, Texas that experienced a blackout during Winter Storm Uri in February of 2021, and investigate which census blocks lost power.

## Background:
From February 13-17, 2021, an uncharacteristic arctic air mass swept across the state of Texas, bringing record-breaking low temperatures and unprecedented amounts of snow and ice across the state. The extreme and unexpected cold caused a surge in electricity demand which prompted a catastrophic failure of the Texas power grid. It's estimated that millions of homes and businesses lost power as a result of the storm<sup>1<sup>.

## Workflow:
The workflow for this analysis can be broken into 4 parts, detailed below.

#### 1) Nightlights
The approximate extent of blackouts during Winter Storm Uri is estimated by calculating changes in luminance recorded by NASA satellites. Luminance data is provided through NASA's Level-1 and Atmospheric Archive & Distribution System Distributed Active Archive Center (LAADS DAAC)<sup>2<sup> . 

#### 2) Houston Residences
The number of homes affected by blackouts is estimated based on the overlap of significant luminance decreases, and housing locations for Houston, Texas obtained from OpenStreetMap's download server<sup>3<sup> .

#### 3) Affected Census Blocks
The number and location of census blocks affected by blackouts are estimated based on the overlap of houses that experiencee blackouts and Houston 2019 census tracts provided by the U.S. Census Bureau's American Community Survey (ACS)<sup>4<sup> .


#### 4) Socioeconomic Correlations
Correlations between blackouts and median income per census block are calculated based on the overlap of blackout locations and median income per census block provided by the U.S. Census Bureau's ACS<sup>4<sup>

Additional data access information can be found in the "Data Access" section of the README in this project repository.



```{r}
#| message: false
library(tidyverse) 
library(janitor) # data cleaning
library(sf) # vector handling
library(terra) # raster handling
library(tidyverse)
library(tmap) # map making
library(spData) # spatial data
library(spDataLarge) # spatial data
library(stars) # raster handling
library(raster) # raster handling

```

## 1) Houston Nightlights

##### 1a) Import data - standardize dimensions, resolution and CRS
```{r}

# nightlight data for February 7, tile h08v05
nl_feb7_05 <- read_stars("data/VNP46A1/VNP46A1.A2021038.h08v05.001.2021039064328.tif")

# nightlight data for February 7, tile h08v06
nl_feb7_06 <- read_stars("data/VNP46A1/VNP46A1.A2021038.h08v06.001.2021039064329.tif")

# nightlight data for February 16, tile h08v05
nl_feb16_05 <- read_stars("data/VNP46A1/VNP46A1.A2021047.h08v05.001.2021048091106.tif")

# nightlight data for February 16, tile h08v06
nl_feb16_06 <- read_stars("data/VNP46A1/VNP46A1.A2021047.h08v06.001.2021048091105.tif")

# Check dimensions
if (all(dim(nl_feb7_06) == dim(nl_feb16_05)) && 
    all(dim(nl_feb7_06) == dim(nl_feb16_06)) &&
    all(dim(nl_feb7_06) == dim(nl_feb7_05))) {
  message("All rasters have the same dimensions")
} else {
  message("Rasters do not have the same dimensions")
}

# Check resolution
if (all(st_res(nl_feb7_06) == st_res(nl_feb16_05)) && 
    all(st_res(nl_feb7_06) == st_res(nl_feb16_06)) &&
    all(st_res(nl_feb7_06) == st_res(nl_feb7_05))) {
  message("All rasters have the same resolution")
} else {
  message("Rasters do not have the same resolution")
}

# Compare CRS of rasters
rasters <- list(nl_feb7_05, nl_feb7_06, nl_feb16_05, nl_feb16_06)

crs_match <- all(sapply(rasters[-1], function(x) compareCRS(rasters[[1]], x)))

if (crs_match) {
  message ("All Rasters have the same CRS")
} else {
  message("All Rasters do NOT have the same CRS")
}

# Save reference resolution
res_reference <- st_res(nl_feb7_05)
crs_reference <- st_crs(nl_feb7_05)
```

##### 1b) Visualize night light intensity before and after the storm
```{r}
#| warning: false
# Create bounds
bounds <- st_bbox(c(xmin = -96.5, ymin = 29, xmax = -94.5, ymax = 30.5), crs = st_crs(crs_reference))

# merge rasters and crop to Houston bounds
nl_feb7 = st_mosaic(nl_feb7_05, nl_feb7_06) %>%
  st_warp(crs = crs_reference, cellsize = res_reference, use_gdal = TRUE) %>% 
  st_crop(bounds)

nl_feb16 = st_mosaic(nl_feb16_05, nl_feb16_06) %>% 
  st_warp(crs = crs_reference, cellsize = res_reference, use_gdal = TRUE) %>% 
  st_crop(bounds)

feb7_map <- tm_shape(nl_feb7) +
  tm_raster(col.scale = tm_scale_continuous(
      values = "inferno",
      limits = c(0, 2000)),
      col.legend = tm_legend(title = "Luminance") ) +
  tm_title(text = "February 7, 2021", size = 1) +
  tm_compass() +
  tm_scalebar(position = c(0.25, 0))
      
feb16_map <- tm_shape(nl_feb16) +
  tm_raster(col.scale = tm_scale_continuous(
      values = "inferno",
      limits = c(0, 2000)),
      col.legend = tm_legend(title = "Luminance")) +
  tm_title(text = "February 16, 2021", size = 1) +
  tm_compass() +
  tm_scalebar(position = c(0.25, 0))

tmap_arrange(feb7_map,feb16_map)
```
  *The figure above shows luminance in Houston, TX before and after Winter storm Uri. Note multiple patches of darkness in NW and NE Houston.*


```{r}
#| warning: False
# Find the difference between the two rasters for both tiles
nl_diff <- (nl_feb7 - nl_feb16)

# Create reclassification matrix using external function
source("class_function.R")

# Apply reclassification function
diff_rcf <- st_apply(nl_diff, MARGIN = c(1, 2), FUN = function(x) reclassify(x, threshold = 200))

# Crop mask to Houston
houston_mask <- st_crop(diff_rcf, bounds)
```

##### 1c) Remove highways from mask
```{r}
#| warning: false
# Read in highway data, specify only highways
highways <- st_read("data/gis_osm_roads_free_1.gpkg", 
        query = "SELECT * FROM gis_osm_roads_free_1 WHERE fclass='motorway'",
        quiet = TRUE)

# Reproject to Texas South Central (ftUS)
highways <- st_transform(highways, crs= "EPSG:2278")

# Buffer by 200m = 656.168 ft. Reproject to old CRS
hw_buffer <- st_buffer(highways, dist = 656.168) %>% 
  st_transform(crs = st_crs(houston_mask)) %>% 
  vect() # Turn into a Spatial Vector

# Turn houston mask into a SpatRaster
houston_mask_terra <- rast(houston_mask)

# Set cells within buffer to NA, crop to Houston bounds
residential_blackouts <- mask(houston_mask_terra, hw_buffer, inverse = TRUE) %>% 
  crop(bounds)

# Check if highway mask reduced values
print(paste(
    "Highway mask removed", 
   round( ((sum(values(houston_mask_terra) == 1, na.rm = TRUE) -
          sum(values(residential_blackouts) == 1, na.rm = TRUE)) /
       sum(values(houston_mask_terra) == 1, na.rm = TRUE) * 100)),
   "% of blackout values"))
```


# 2) Estimate of homes that lost power

Now we have a raster of all non-highway locations in Houston that experienced a blackout, and a shapefile with  a multipolygon for each residence in Houston. The next thing we need to do is find out how many of the homes fall within the blackout raster. In order to do this, we will need to turn the homes into points, turn the blackout raster back into a vector, and use st_intersects to find the number of points within polygons created by the blackout raster.

##### 2a) Read in homes data, match CRS.
```{r}
# Read in homes data, specify residences
homes <- st_read("data/gis_osm_buildings_a_free_1.gpkg",
  query = "
    SELECT *
    FROM gis_osm_buildings_a_free_1
    WHERE 
      (type IS NULL AND name IS NULL)
      OR type IN ('residential', 'apartments', 'house', 'static_caravan', 'detached')
  ",
  quiet = TRUE
) %>% janitor::clean_names()

# Check to make sure CRS matches. If not, match them
if (st_crs(homes) == st_crs(residential_blackouts)) {
  message("CRS match")
} else {
  message("CRS do not match, transforming CRS to st_crs(residential_blackouts)")
  homes <- st_transform(homes, st_crs(residential_blackouts))
}
```

##### 2b) Find overlap between blackout data and residential data
```{r}
#| warning: false
# Turn blackout raster into polygons where blackout is present, merge adjacent polygons
blackout_polygons <- as.polygons(residential_blackouts == 1, dissolve = TRUE) %>% 
  st_as_sf()

# Turn homes from multi-polygons into polygons, then into points
homes_points <- homes %>% 
  st_cast("POLYGON") %>% 
  st_centroid() %>% 
  st_as_sf()

homes_points$in_blackout <- lengths(st_intersects(homes_points, blackout_polygons)) > 0

# Get number of homes that lost power
blackout_homes <- sum(homes_points$in_blackout, na.rm = TRUE)

# Print
print(paste0("approximately ", blackout_homes, " residential buildings in Houston, Texas lost power during Winter Storm Uri in February, 2021"))
```
##### 2c) Visualize Blackout Home Locations

```{r}
#| message: false
# Filter home_points to only those which experienced a blackout
blackout_homes <- homes_points %>% 
  filter(in_blackout == TRUE) %>%
  mutate(label = "Homes Which Experienced Blackout")  # Create a constant variable for the legend

tm_basemap(server = "https://tile.openstreetmap.org/{z}/{x}/{y}.png", alpha = 1) +
tm_shape(blackout_homes) +
  tm_dots(fill = "label",  # Map to the new variable
          fill.scale = tm_scale(values = "#C0369d"),  # Set the color
          size = 0.1,
          fill.legend = tm_legend(title = "Legend")) +
  tm_title(text = "Houston Homes that Experienced Blackouts During Winter Storm Uri") +
  tm_compass() +
  tm_scalebar(position = c("bottom", "left"))

```



# 3) Map of census tracts that lost power

```{r}
#| message: false
#| warning: false
# Read in census shapes
census <- st_read("data/ACS_2019_5YR_TRACT_48_TEXAS.gdb", layer =  "ACS_2019_5YR_TRACT_48_TEXAS", quiet = TRUE) %>% 
  st_transform(crs = crs_reference) %>% 
  st_crop(bounds)

# Filter home_points to only those which experienced a blackout
blackout_homes <- homes_points %>% 
  filter(in_blackout == TRUE)

# Create a list of census blocks which overlap with blackout
blocks_list <- st_intersects(census, blackout_homes)

# Filter census data by values where there is at least one intersection with blackout homes
blackout_blocks <- census %>%
  filter(lengths(blocks_list) > 0)

# Plot census tracts that experienced blackouts
tm_shape(census) +
  tm_polygons(col = "gray", border.col = "white") +
tm_shape(blackout_blocks) +
  tm_polygons(col = "#C0369D", alpha = 0.7, border.col = "white") +
  tm_title(text = "Census Tracts that Experienced Blackouts") +
  tm_add_legend(type = "fill", 
                col = c("gray", "#C0369D"),
                labels = c("No blackout", "Experienced blackout"),
                title = "") +
  tm_compass() +
  tm_scalebar()

```
# 4) Socioeconomic Correlations

Now that we have an approximation of the number and location of census blocks that were affected by the blackouts, we can investigate correlations between power loss and socioeconomic factors by utilizing income data for the State of Texas. This analysis will investigate a correlation between median income and power loss during Winter Storm Uri.

```{r}
#| warning: false
# Read in income data
income_raw <- st_read("data/ACS_2019_5YR_TRACT_48_TEXAS.gdb", layer =  "X19_INCOME", quiet = TRUE)

# select median income and geoid columns from income dataframe
median_income <- income_raw %>% 
  dplyr::select(B19013e1, GEOID)

# join the income data to census tract shapes in Texas
texas_income_merge <- left_join(census, median_income, by = c("GEOID_Data" = "GEOID")) %>%
  mutate(blackout = GEOID %in% blackout_blocks$GEOID) # Add column w/ True or False for Blackout

# Plot income distributions
ggplot(texas_income_merge, aes(x = blackout, y = B19013e1, fill = blackout)) +
  geom_boxplot() +
  scale_fill_manual(values = c("gray70", "#C0369D")) +
  labs(
    title = "Median Income by Blackout Status",
    x = "Blackout Occurred",
    y = "Median Household Income (USD)"
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none")

```
## Interpretation:

  The boxplot above shows that the median income for census tracts that experienced blackouts was only slightly higher than that of tracts that did not. The larger box for blackout-affected tracts indicates a somewhat wider spread in household incomes within those areas. Overall, these results suggest no clear relationship between median household income and the likelihood of experiencing a blackout during Winter Storm Uri in the City of Houston.
  
  
## References:

<sup>1</sup> Wikipedia contributors. (2025, November 11). February 13–17, 2021 North American winter storm. In *Wikipedia: The Free Encyclopedia*. Retrieved November 11, 2025, from https://en.wikipedia.org/wiki/February_13%E2%80%9317%2C_2021_North_American_winter_storm  

<sup>2</sup> NASA EOSDIS Level 1 and Atmosphere Archive & Distribution System. (2025, November 11). *LAADSWeb – Home*. Retrieved November 11, 2025, from [https://ladsweb.modaps.eosdis.nasa.gov/](https://ladsweb.modaps.eosdis.nasa.gov/)  

<sup>3</sup> Geofabrik GmbH. (2025, November 11). *Downloads – Geofabrik Data*. Retrieved November 11, 2025, from https://www.geofabrik.de/data/download.html  

<sup>4</sup> U.S. Census Bureau. (n.d.). *American Community Survey (ACS).* Retrieved November 11, 2025, from https://www.census.gov/programs-surveys/acs







